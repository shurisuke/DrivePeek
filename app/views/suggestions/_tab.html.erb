<%# 提案タブ: ChatGPT風チャットUI %>

<%# ユーザーメッセージ用テンプレート（JS即時表示用） %>
<template id="user-message-template">
  <div class="suggestion__message-wrapper">
    <div class="suggestion__divider"></div>
    <div class="suggestion__msg suggestion__msg--user">
      <div class="suggestion__content">
        <div class="suggestion__bubble"></div>
        <div class="suggestion__meta">
          <span class="suggestion__time"></span>
        </div>
      </div>
    </div>
  </div>
</template>

<div class="suggestion" data-controller="suggestion">
  <%# メッセージ一覧エリア %>
  <div class="suggestion__messages" id="suggestion-messages" data-suggestion-target="messages">
    <%# AI側: 案内文 + モード選択（初期表示） %>
    <div class="suggestion__msg suggestion__msg--assistant">
      <div class="suggestion__icon">
        <i class="bi bi-stars"></i>
      </div>
      <div class="suggestion__content">
        <div class="suggestion__bubble">
          こんにちは！ドライブプランのAIアシスタントです。
        </div>
        <%= render "suggestions/mode_select" %>
      </div>
    </div>

    <%# 保存済み会話履歴を表示（時系列順：古い→新しい） %>
    <% plan.suggestions.chronological.each do |msg| %>
      <%= render "suggestions/message",
                 content: msg.display_message,
                 role: msg.role,
                 spots: msg.display_spots,
                 plan_data: msg.display_plan,
                 plan: plan,
                 intro: msg.display_intro,
                 closing: msg.display_closing,
                 response_type: msg.response_type,
                 area_data: msg.area_data %>
    <% end %>
  </div>

</div>
