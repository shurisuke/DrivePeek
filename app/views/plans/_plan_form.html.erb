<% content_for :body_class, "no-footer" %>

<div class="main-content plan-form">
  <!-- 地図 -->
  <div id="map" class="map" data-plan-id="<%= plan.id %>"></div>

  <!-- 🔍 検索バー（地図上部に重ねる用） -->
  <div class="map-search-box">
    <input
      id="places-search-box"
      type="text"
      placeholder="スポット名や施設名で検索"
      class="form-control"
    >
  </div>

  <!-- 左ナビバー（Turbo Frame化） -->
  <%= turbo_frame_tag "planbar" do %>
    <%= render "plans/form_components/planbar", plan: plan %>
  <% end %>

  <!-- ✅ 時計ボタン＋白背景（固定・スクロールに巻き込まれない） -->
  <div class="plan-time-toggle-header"
       data-controller="plan-time-toggle"
       data-plan-time-toggle-planbar-selector-value=".planbar">
    <button type="button"
            class="plan-time-fab"
            aria-label="時間表示のオン/オフ"
            aria-pressed="false"
            data-action="click->plan-time-toggle#toggle">
      <%= image_tag "clock.png",
                    class: "plan-time-fab__icon",
                    alt: "",
                    aria: { hidden: true } %>
    </button>
  </div>

  <!-- プラン保存ボタン＋モーダル（コントローラは外側のラッパーに） -->
  <div data-controller="plan-save-modal" data-plan-save-modal-plan-id-value="<%= plan.id %>">
    <div class="plan-save">
      <button type="button" class="btn btn-save" data-action="click->plan-save-modal#open">
        プランを保存
      </button>
    </div>

    <!-- 保存モーダル（オーバーレイ）- transform影響を避けるためplan-saveの外に配置 -->
    <div class="plan-save-modal" data-plan-save-modal-target="modal" hidden>
      <div class="plan-save-modal__overlay" data-action="click->plan-save-modal#close"></div>
      <div class="plan-save-modal__dialog">
        <p class="plan-save-modal__message">名前をつけてプランを保存してください</p>
        <input
          type="text"
          class="form-control plan-save-modal__input"
          placeholder="プラン名を入力"
          data-plan-save-modal-target="input"
          data-action="keydown.enter->plan-save-modal#save"
        >
        <p class="plan-save-modal__error" data-plan-save-modal-target="error" hidden>プラン名を入力してください</p>
        <div class="plan-save-modal__actions">
          <button type="button" class="btn btn-cancel" data-action="click->plan-save-modal#close">キャンセル</button>
          <button type="button" class="btn btn-primary" data-action="click->plan-save-modal#save">保存</button>
        </div>
      </div>
    </div>
  </div>

</div>
