<%# スポットカード（検索結果表示用の共通部品） %>
<%# locals: spot:, favorite_spot: nil, preview_mode: false %>

<%
  _preview_mode = local_assigns.fetch(:preview_mode, false)
  spot_location = [spot.prefecture, spot.city].compact.reject(&:blank?).join("/")
  plans_count = spot.plans.count
%>

<div class="spot-card">
  <div class="spot-card__header">
    <h3 class="spot-card__name"><%= spot.name %></h3>
    <div class="spot-card__actions">
      <%= render "favorite_spots/button", spot: spot, favorite_spot: favorite_spot %>
    </div>
  </div>

  <% if spot.genres.any? %>
    <div class="spot-card__genres">
      <% spot.genres.each do |genre| %>
        <span class="spot-card__genre"><%= genre.name %></span>
      <% end %>
    </div>
  <% end %>

  <% if spot_location.present? %>
    <div class="spot-card__location">
      <i class="bi bi-geo-alt" aria-hidden="true"></i>
      <%= spot_location %>
    </div>
  <% end %>

  <div class="spot-card__footer">
    <div class="spot-card__plans-count">
      <i class="bi bi-people" aria-hidden="true"></i>
      <span><%= plans_count %></span>人がドライブしました
    </div>

    <% if _preview_mode && spot.lat.present? && spot.lng.present? && spot.place_id.present? %>
      <button type="button"
              class="spot-card__map-link spot-card__map-link--preview"
              aria-label="地図でこのスポットを見る"
              data-controller="single-spot-preview"
              data-single-spot-preview-lat-value="<%= spot.lat %>"
              data-single-spot-preview-lng-value="<%= spot.lng %>"
              data-single-spot-preview-name-value="<%= spot.name %>"
              data-single-spot-preview-address-value="<%= spot.address %>"
              data-single-spot-preview-place-id-value="<%= spot.place_id %>"
              data-single-spot-preview-genres-value="<%= spot.genres.first(2).map(&:name).to_json %>"
              data-action="click->single-spot-preview#show">
        <i class="bi bi-geo-alt-fill" aria-hidden="true"></i>
        地図で見る
      </button>
    <% else %>
      <%= link_to spot_path(spot), class: "spot-card__map-link", aria: { label: "スポット詳細を見る" } do %>
        地図で見る
        <i class="bi bi-chevron-right" aria-hidden="true"></i>
      <% end %>
    <% end %>
  </div>
</div>
