<% content_for :body_class, "no-footer" %>

<script>
  window.planData = <%= raw(json_escape(@plan.marker_data_for_public_view.to_json)) %>;
</script>

<div class="main-content plan-detail"
     data-controller="planbar-resize"
     data-planbar-resize-min-value="300"
     data-planbar-resize-max-percent-value="88"
     data-planbar-resize-default-value="350"
     data-planbar-resize-storage-key-value="drive_peek:planbar_detail_width"
     data-planbar-resize-collapsed-key-value="drive_peek:planbar_detail_collapsed"
     data-planbar-resize-slide-key-value="drive_peek:planbar_detail_slide">
  <!-- 地図 -->
  <div id="map" class="map" data-map-mode="show" data-plan-id="<%= @plan.id %>" data-planbar-resize-target="map"></div>

  <!-- リサイズハンドル -->
  <div class="planbar-resize-handle"
       data-planbar-resize-target="handle"
       data-action="mousedown->planbar-resize#startResize touchstart->planbar-resize#startResize click->planbar-resize#handleClick">
    <div class="planbar-resize-handle__grip"></div>
  </div>

  <!-- ナビバー（詳細用・1タブ） -->
  <aside class="planbar planbar--show">
    <div class="planbar__content">
      <div class="planbar__content-scroll">
        <div class="planbar__header">
          <h1 class="planbar__title"><%= @plan.title.presence || "ドライブプラン" %></h1>
        </div>
        <div class="planbar__blocks">
          <%= render "plans/show_components/plan_content", plan: @plan %>
        </div>
      </div>
    </div>

    <% if @plan.plan_spots.size >= 2 %>
      <div class="planbar__footer">
        <div class="plan-summary">
          <div class="plan-summary__item">
            <i class="bi bi-signpost-2" aria-hidden="true"></i>
            <span class="plan-summary__value"><%= @plan.spots_only_distance %></span>
            <span class="plan-summary__unit">km</span>
          </div>
          <div class="plan-summary__item">
            <i class="bi bi-clock" aria-hidden="true"></i>
            <span class="plan-summary__value"><%= format_move_time(@plan.spots_only_move_time) %></span>
          </div>
        </div>
      </div>
    <% end %>
  </aside>
</div>
