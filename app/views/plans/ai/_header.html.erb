<%# AI提案チャット: ヘッダー（モード切替 + メニュー） %>
<%# locals: plan:, mode: "plan" %>
<% current_mode = local_assigns.fetch(:mode, "plan") %>
<div class="ai-chat__header-content">
  <%# ヘルプボタン（モード説明） %>
  <div class="ai-chat__header-spacer ai-chat__header-spacer--start">
    <button type="button"
            class="ai-chat__help-btn"
            data-controller="help-dialog"
            data-help-dialog-title-value="提案タイプが変更できます"
            data-help-dialog-body-value="<div class='help-dialog__item'><strong>プラン</strong><p>ルート全体を提案。<br>目的エリアや条件を伝えてください。</p></div><div class='help-dialog__item'><strong>スポット</strong><p>個別のスポットを深掘りして紹介。<br>ジャンルやエリアを教えてください。</p></div>"
            data-action="click->help-dialog#show"
            aria-label="モードについて">?</button>
  </div>

  <%# セグメントコントロール（iOS風モード切替）- ラジオボタン使用 %>
  <div class="ai-chat__segment">
    <input type="radio" name="mode" value="plan" id="mode-plan"
           class="ai-chat__segment-radio" form="ai-chat-form" <%= "checked" if current_mode == "plan" %>>
    <label for="mode-plan" class="ai-chat__segment-btn">プラン</label>

    <input type="radio" name="mode" value="spot" id="mode-spot"
           class="ai-chat__segment-radio" form="ai-chat-form" <%= "checked" if current_mode == "spot" %>>
    <label for="mode-spot" class="ai-chat__segment-btn">スポット</label>
  </div>

  <%# 三点メニュー %>
  <div class="ai-chat__header-spacer ai-chat__header-spacer--end">
    <div class="ai-chat__menu" data-controller="dropdown">
      <button type="button"
              class="ai-chat__menu-btn"
              data-action="click->dropdown#toggle"
              aria-label="メニュー">
        <i class="bi bi-three-dots"></i>
      </button>
      <div class="ai-chat__menu-dropdown" data-dropdown-target="menu" hidden>
        <%= button_to destroy_all_api_ai_chats_path(plan_id: plan.id),
              method: :delete,
              id: "ai-chat-clear-btn",
              class: "ai-chat__menu-item ai-chat__menu-item--danger",
              disabled: !plan.ai_chat_messages.exists?,
              data: { turbo_confirm: "会話履歴をクリアしますか？", action: "turbo:submit-end->ai-chat#clearConversation" } do %>
          <i class="bi bi-trash"></i>
          <span>会話をクリア</span>
        <% end %>
      </div>
    </div>
  </div>
</div>
