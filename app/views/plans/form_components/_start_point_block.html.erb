<%# app/views/plans/form_components/_start_point_block.html.erb %>
<% plan ||= @plan %>

<div class="start-point-block" data-controller="start-point-editor">
  <div class="start-point-main">
    <div class="start-label">
      <div class="start-label__row">
        <span class="icon" aria-hidden="true"></span>

        <div class="start-text">
          <div class="start-title">出発</div>

          <span class="address" data-start-point-editor-target="address">
            <%= plan.start_point&.address.presence || "出発地点が未設定です" %>
          </span>
        </div>
      </div>
    </div>

    <button
      type="button"
      class="start-point-change-btn"
      data-start-point-editor-target="toggle"
      data-action="click->start-point-editor#toggle"
      aria-expanded="false"
      aria-controls="start-point-edit-<%= plan.id %>"
    >
      <i class="bi bi-pencil-fill" aria-hidden="true"></i>
      <span class="visually-hidden">出発地点を変更</span>
    </button>
  </div>

  <div
    id="start-point-edit-<%= plan.id %>"
    class="start-point-edit"
    hidden
    data-start-point-editor-target="editArea"
  >
    <div class="start-point-edit__inner">
      <label
        for="start-point-address-<%= plan.id %>"
        class="start-point-edit__label"
      >
        出発地点を変更
      </label>

      <input
        id="start-point-address-<%= plan.id %>"
        type="text"
        class="form-control start-point-edit__input"
        placeholder="（例: 〇〇市〇〇町〇〇-〇）"
        autocomplete="off"
        data-start-point-editor-target="input"
        data-action="keydown->start-point-editor#search compositionstart->start-point-editor#compositionStart compositionend->start-point-editor#compositionEnd"
      >

      <div class="start-point-edit__help">Enterで検索 → 更新</div>
    </div>
  </div>

  <%# ✅ 出発地点が設定済み＆スポットが1件以上のときだけ「詳細（有料道路/距離）」トグルを表示 %>
  <% if plan.start_point.present? && plan.plan_spots.exists? %>
    <div class="start-point-detail-wrap">
      <div class="collapse start-point-detail" id="startPointDetail-<%= plan.id %>">
        <div class="start-point-detail__inner">

          <%# ✅ spot-block と同じ：2行を1枚の枠（trip-summary）にまとめる %>
          <div class="trip-summary">
            <%# ✅ 上段：有料道路（トグルスイッチ化） %>
            <div class="trip-info">
              <span class="label">有料道路</span>

              <div class="toll-switch">
                <div class="form-check form-switch m-0">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    role="switch"
                    aria-label="有料道路の使用を切り替える（出発）"
                    data-start-point-toll-used-switch="1"
                    data-plan-id="<%= plan.id %>"
                    <%= 'checked="checked"' if plan.start_point&.toll_used? %>
                  >
                </div>
              </div>

              <%# ✅ spot と列幅を揃えるためのダミー（必要なら後で実値に） %>
              <span class="price"></span>
            </div>

            <%# ✅ 下段：次の場所まで %>
            <div class="distance-info">
              <span>次の場所まで</span>
              <span class="km">〇〇km</span>
              <span class="time">〇〇時間〇〇分</span>
            </div>
          </div>

        </div>
      </div>

      <button
        type="button"
        class="detail-toggle"
        data-bs-toggle="collapse"
        data-bs-target="#startPointDetail-<%= plan.id %>"
        aria-expanded="false"
        aria-controls="startPointDetail-<%= plan.id %>"
      >
        <i class="bi bi-caret-down-fill"></i>
      </button>
    </div>
  <% end %>
</div>