<%= render "plans/form_components/start_point_block" %>

<% user_spots_by_spot_id =
     current_user.user_spots
       .includes(user_spot_tags: :tag)
       .where(spot_id: @plan.plan_spots.select(:spot_id))
       .index_by(&:spot_id)
%>

<% @plan.plan_spots.includes(:spot).order(:position).each do |plan_spot| %>
  <% user_spot = user_spots_by_spot_id[plan_spot.spot_id] %>

  <%= render "plans/form_components/spot_block",
             plan_spot: plan_spot,
             user_spot: user_spot %>
<% end %>