<aside class="navibar"
       data-controller="navibar bottom-sheet"
       data-bottom-sheet-min-value="8"
       data-bottom-sheet-mid-value="45"
       data-bottom-sheet-max-value="85"
       data-bottom-sheet-state-value="mid">
  <%# モバイル用ドラッグハンドル %>
  <div class="navibar__handle" data-bottom-sheet-target="handle">
    <div class="navibar__handle-bar"></div>
  </div>

  <div class="plan-tab-nav">
    <button class="tab-btn tab-community"
            data-tab="community"
            data-navibar-target="button"
            data-action="click->navibar#switch">
      みんなの旅
    </button>

    <button class="tab-btn active"
            data-tab="plan"
            data-navibar-target="button"
            data-action="click->navibar#switch">
      プラン
    </button>

    <button class="tab-btn tab-ai"
            data-tab="ai"
            data-navibar-target="button"
            data-action="click->navibar#switch">
      AI提案
    </button>
  </div>

  <div class="navibar__content" id="navibar_content">
    <%# ✅ スクロールコンテナ: OFF時350px / ON時430px %>
    <div class="navibar__content-scroll">
      <%# ブロック一覧（常時350px） %>
      <div class="navibar__blocks" id="navibar_blocks">
        <%= render "plans/navibar_tabs", plan: plan %>
      </div>
      <div id="navibar_footer">
        <%= render "plans/navibar_footer", plan: plan %>
      </div>
    </div>
  </div>

  <%# AI提案タブ用フッター（入力欄） %>
  <div class="ai-chat__composer"
       data-navibar-target="footer"
       data-tab="ai">
    <%= render "plans/ai/form", plan: plan %>
  </div>

  <%# モバイル用アクションボタン（ナビバー内に配置） %>
  <div class="navibar__actions"
       data-navibar-target="footer"
       data-tab="plan"
       data-controller="plan-save-modal"
       data-plan-save-modal-plan-id-value="<%= plan.id %>"
       data-plan-save-modal-title-value="<%= plan.title %>">
    <button type="button"
            class="navibar__action-btn navibar__action-btn--share"
            data-controller="share-modal"
            data-share-modal-url-value="<%= plan_url(plan) %>"
            data-share-modal-plan-id-value="<%= plan.id %>"
            data-action="click->share-modal#open">
      <i class="bi bi-box-arrow-up"></i>
      共有
    </button>
    <button type="button"
            class="navibar__action-btn navibar__action-btn--save"
            data-action="click->plan-save-modal#open">
      <i class="bi bi-bookmark"></i>
      保存
    </button>
  </div>
</aside>
