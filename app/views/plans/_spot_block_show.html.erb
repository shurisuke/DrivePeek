<%# app/views/plans/_spot_block_show.html.erb %>
<%# locals: plan_spot:, is_last_spot: false %>

<% spot = plan_spot.spot %>
<% move_minutes = plan_spot.move_time.to_i %>
<% hours = move_minutes / 60 %>
<% minutes = move_minutes % 60 %>

<div
  class="spot-block spot-block--show"
  data-spot-id="<%= spot.id %>"
  data-plan-spot-id="<%= plan_spot.id %>"
  data-position="<%= plan_spot.position %>"
  data-lat="<%= spot.lat %>"
  data-lng="<%= spot.lng %>"
  data-polyline="<%= plan_spot.polyline %>"
  data-place-id="<%= spot.place_id %>"
>
  <%# ✅ 編集画面と同じ構造（spot-info-group > spot-content） %>
  <div class="spot-info-group">
    <div class="spot-content">
      <%# 3層構造: アイコン | 名前 | スペーサー %>
      <div class="spot-header navibar-padding">
        <div class="spot-order-column">
          <div class="spot-order-icon"
               data-controller="ui--navibar-marker-button"
               data-action="click->ui--navibar-marker-button#spot"
               role="button"
               tabindex="0"
               aria-label="スポットを地図で表示"><%= plan_spot.position %></div>
        </div>

        <% if spot.name.present? %>
          <div class="spot-name spot-name--clickable"
               data-controller="ui--navibar-marker-button"
               data-action="click->ui--navibar-marker-button#spot"
               role="button"
               tabindex="0"><%= spot.name %></div>
        <% end %>

        <div class="spot-spacer" aria-hidden="true"></div>
      </div>

      <%# ジャンル %>
      <%= render "spots/genres", spot: spot, loading: false %>

      <%# 住所 %>
      <% if spot.address.present? %>
        <div class="spot-address navibar-padding"><%= spot.address %></div>
      <% end %>

      <%# メモ表示（閲覧専用） %>
      <% if plan_spot.memo.present? %>
        <div class="spot-memo spot-memo--pin navibar-padding">
          <div class="spot-memo__content">
            <i class="bi bi-sticky spot-memo__icon" aria-hidden="true"></i>
            <%= simple_format(h(plan_spot.memo)) %>
          </div>
        </div>
      <% end %>

      <%# 次の場所まで %>
      <% unless is_last_spot %>
        <div class="spot-next-move">
          <span class="label">次の場所<span class="label-unit">まで</span></span>
          <span class="separator"></span>
          <span class="km">
            <%= format_distance(plan_spot.move_distance) %><span class="km-unit">km</span>
          </span>
          <span class="separator"></span>
          <span class="time"><% if hours > 0 %><%= hours %><span class="time-unit">時間</span><% end %><%= minutes %><span class="time-unit">分</span></span>
        </div>
        <% if plan_spot.toll_used %>
          <div class="toll-indicator">有料道路使用あり</div>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
