<%# app/views/plans/_spot_block_show.html.erb %>
<%# locals: plan_spot:, is_last_spot: false %>
<% spot = plan_spot.spot %>
<% move_minutes = plan_spot.move_time.to_i %>
<% hours = move_minutes / 60 %>
<% minutes = move_minutes % 60 %>

<%# 最後のスポットの「次の場所まで」は帰宅地点への距離なので非表示 %>

<div
  class="spot-block spot-block--show"
  data-spot-id="<%= spot.id %>"
  data-plan-spot-id="<%= plan_spot.id %>"
  data-position="<%= plan_spot.position %>"
  data-lat="<%= spot.lat %>"
  data-lng="<%= spot.lng %>"
  data-polyline="<%= plan_spot.polyline %>"
  data-place-id="<%= spot.place_id %>"
>
  <div class="block-main-content">
    <%# ✅ 3層構造: アイコン | スポット名 | ピンボタン %>
    <div class="spot-main">
      <div class="spot-order-icon" aria-hidden="true"><%= plan_spot.position %></div>

      <div class="spot-body">
        <% if spot.name.present? %>
          <div class="spot-name"><%= spot.name %></div>
        <% end %>
      </div>

      <button type="button"
              class="spot-map-btn"
              data-controller="navibar-marker-button"
              data-action="click->navibar-marker-button#spot"
              aria-label="地図で表示">
        <i class="bi bi-geo-alt-fill" aria-hidden="true"></i>
      </button>
    </div>

    <%# ✅ ジャンル・住所（3層構造の下に配置、左右padding 10px） %>
    <div class="spot-meta">
      <% if spot.genres.any? %>
        <div class="spot-genres">
          <% spot.genres.each do |genre| %>
            <span class="genre-chip"><%= genre.name %></span>
          <% end %>
        </div>
      <% end %>

      <% if spot.address.present? %>
        <div class="spot-address"><%= spot.address %></div>
      <% end %>
    </div>

    <%# ✅ 次の場所まで（3カラム構造の外に配置） %>
    <% unless is_last_spot %>
      <div class="spot-next-move">
        <span class="label">次の場所まで</span>
        <span class="km">
          <%= format_distance(plan_spot.move_distance) %><span class="km-unit">km</span>
        </span>
        <span class="time"><% if hours > 0 %><%= hours %><span class="time-unit">時間</span><% end %><%= minutes %><span class="time-unit">分</span></span>
      </div>
      <% if plan_spot.toll_used %>
        <div class="toll-indicator">有料道路使用あり</div>
      <% end %>
    <% end %>
  </div>
</div>
