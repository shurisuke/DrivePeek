<%# app/views/plans/_spot_block_show.html.erb %>
<%# locals: plan_spot:, is_last_spot: false %>
<% spot = plan_spot.spot %>
<% move_minutes = plan_spot.move_time.to_i %>
<% hours = move_minutes / 60 %>
<% minutes = move_minutes % 60 %>

<%# 最後のスポットの「次の場所まで」は帰宅地点への距離なので非表示 %>

<div
  class="spot-block spot-block--show"
  data-spot-id="<%= spot.id %>"
  data-plan-spot-id="<%= plan_spot.id %>"
  data-position="<%= plan_spot.position %>"
  data-lat="<%= spot.lat %>"
  data-lng="<%= spot.lng %>"
  data-polyline="<%= plan_spot.polyline %>"
  data-place-id="<%= spot.place_id %>"
>
  <%# ✅ 3層構造: アイコン | コンテンツ | スペーサー %>
  <div class="spot-main">
      <div class="spot-order-icon"
           data-controller="navibar-marker-button"
           data-action="click->navibar-marker-button#spot"
           role="button"
           tabindex="0"
           aria-label="スポットを地図で表示"><%= plan_spot.position %></div>

      <div class="spot-body">
        <% if spot.name.present? %>
          <div class="spot-name spot-name--clickable"
               data-controller="navibar-marker-button"
               data-action="click->navibar-marker-button#spot"
               role="button"
               tabindex="0"><%= spot.name %></div>
        <% end %>

        <%= render "spots/genres", spot: spot, loading: false %>

        <% if spot.address.present? %>
          <div class="spot-address"><%= spot.address %></div>
        <% end %>

        <%# ✅ 次の場所まで（spot-body内に配置） %>
        <% unless is_last_spot %>
          <div class="spot-next-move">
            <span class="label">次の場所<span class="label-unit">まで</span></span>
            <span class="separator"></span>
            <span class="km">
              <%= format_distance(plan_spot.move_distance) %><span class="km-unit">km</span>
            </span>
            <span class="separator"></span>
            <span class="time"><% if hours > 0 %><%= hours %><span class="time-unit">時間</span><% end %><%= minutes %><span class="time-unit">分</span></span>
          </div>
          <% if plan_spot.toll_used %>
            <div class="toll-indicator">有料道路使用あり</div>
          <% end %>
        <% end %>
      </div>

    <%# ✅ 左アイコンと同じ幅のスペーサー（視覚的バランス用） %>
    <div class="spot-spacer" aria-hidden="true"></div>
  </div>
</div>
