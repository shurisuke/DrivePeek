<%# Âú∞Âõ≥‰∏äÈÉ®„ÅÆ„Éò„ÉÉ„ÉÄ„Éº„Éê„Éº: Ê§úÁ¥¢ + „Éî„É´„Éú„Çø„É≥Ôºà„Ç∏„É£„É≥„É´|üî•Ôºâ + „Éè„É≥„Éê„Éº„Ç¨„Éº %>
<% genres_by_category = Genre.grouped_by_category %>

<div class="map-header-bar" data-controller="ui--popular-spots ui--hamburger" data-action="keydown.esc->ui--popular-spots#closeModal">
  <%# Ê§úÁ¥¢„Éê„Éº %>
  <div class="map-header-bar__search">
    <i class="fa-solid fa-magnifying-glass map-header-bar__search-icon"></i>
    <input
      id="places-search-box"
      type="text"
      placeholder="      Ê§úÁ¥¢"
      class="map-header-bar__search-input"
    >
  </div>

  <%# „Éî„É´„Éú„Çø„É≥ÔºàüéöÔ∏è | üî•Ôºâ %>
  <div class="map-header-bar__pill">
    <button type="button"
            class="map-header-bar__pill-left"
            data-action="click->ui--popular-spots#openModal"
            title="Ë©±È°å„ÅÆ„Çπ„Éù„ÉÉ„Éà„ÇíÊé¢„Åô">
      <i class="bi bi-sliders"></i>
    </button>
    <button type="button"
            class="map-header-bar__pill-right"
            data-action="click->ui--popular-spots#show"
            title="Áõõ„Çä‰∏ä„Åå„Å£„Å¶„Çã„Çπ„Éù„ÉÉ„Éà">
      <i class="bi bi-fire"></i>
    </button>
  </div>

  <%# „Éè„É≥„Éê„Éº„Ç¨„Éº„É°„Éã„É•„Éº %>
  <div class="map-header-bar__hamburger hamburger" id="Hamburger" data-ui--hamburger-target="button" data-action="click->ui--hamburger#toggle">
    <div class="hamburger__container">
      <span class="hamburger__top"></span>
      <span class="hamburger__middle"></span>
      <span class="hamburger__bottom"></span>
    </div>
  </div>

  <%# Â±ïÈñã„É°„Éã„É•„Éº %>
  <div class="sp__menu" data-ui--hamburger-target="menu">
    <div class="sp__menu__container">
      <div class="sp__menu__nav">
        <ul id="menu__hamburger__nav" class="sp__menu__ul">
          <% if current_user.present? %>
            <li><%= link_to new_plan_path do %><i class="fa-solid fa-pen"></i><span>„Éó„É©„É≥„Çí‰Ωú„Çã</span><% end %></li>
            <li><%= link_to community_path do %><i class="fa-solid fa-earth-asia"></i><span>„Åø„Çì„Å™„ÅÆÊóÖ</span><% end %></li>
            <li><%= link_to favorites_path do %><i class="fa-solid fa-bookmark"></i><span>„ÅäÊ∞ó„Å´ÂÖ•„Çä</span><% end %></li>
            <li><%= link_to plans_path do %><i class="fa-solid fa-route"></i><span>‰Ωú„Å£„Åü„Éó„É©„É≥</span><% end %></li>
            <li>
              <%= link_to settings_path do %>
                <i class="fa-solid fa-gear"></i>
                <span class="menu-text-with-badge">
                  Ë®≠ÂÆö
                  <% if current_user.age_group.blank? || current_user.residence.blank? %>
                    <span class="menu-badge"></span>
                  <% end %>
                </span>
              <% end %>
            </li>
          <% else %>
            <li><%= link_to unauthenticated_root_path do %><i class="fa-solid fa-house"></i><span>TOP</span><% end %></li>
            <li><%= link_to new_user_registration_path do %><i class="fa-solid fa-user-plus"></i><span>Êñ∞Ë¶èÁôªÈå≤</span><% end %></li>
            <li><%= link_to new_user_session_path do %><i class="fa-solid fa-right-to-bracket"></i><span>„É≠„Ç∞„Ç§„É≥</span><% end %></li>
            <li><%= link_to guide_path do %><i class="fa-solid fa-circle-question"></i><span>‰Ωø„ÅÑÊñπ</span><% end %></li>
          <% end %>
        </ul>
      </div>
    </div>
  </div>

  <%# „Ç∏„É£„É≥„É´ÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ %>
  <div class="popular-spots-modal" hidden data-ui--popular-spots-target="modal">
    <div class="popular-spots-modal__overlay" data-action="click->ui--popular-spots#closeModal"></div>
    <div class="popular-spots-modal__dialog" data-ui--popular-spots-target="dialog">
      <%# „É¢„Éê„Ç§„É´Áî®„Éâ„É©„ÉÉ„Ç∞„Éè„É≥„Éâ„É´ %>
      <div class="popular-spots-modal__handle"
           data-action="touchstart->ui--popular-spots#startDrag touchmove->ui--popular-spots#drag touchend->ui--popular-spots#endDrag">
        <div class="popular-spots-modal__handle-bar"></div>
      </div>
      <div class="popular-spots-modal__header">
        <h3 class="popular-spots-modal__title">Ë©±È°å„ÅÆ„Çπ„Éù„ÉÉ„Éà„ÇíÊé¢„Åô</h3>
        <button type="button"
                class="popular-spots-modal__close-btn"
                data-action="click->ui--popular-spots#closeModal">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>

      <div class="selection-list popular-spots-modal__list">
        <% genres_by_category.each do |category, groups| %>
          <div class="selection-list__region">
            <div class="selection-list__region-label"><%= category %></div>
            <% groups.each do |group| %>
              <% genre = group[:genre] %>
              <% children = group[:children] %>
              <% if children.present? %>
                <div class="selection-list__group" data-parent-group>
                  <div class="selection-list__parent" data-action="click->ui--popular-spots#toggleParent">
                    <input type="checkbox" data-parent-checkbox
                           data-action="click->ui--popular-spots#selectParent">
                    <span><%= genre.name %></span>
                    <i class="bi bi-chevron-down selection-list__toggle"
                       data-action="click->ui--popular-spots#toggleGroup"></i>
                  </div>
                  <div class="selection-list__children">
                    <% children.each do |child| %>
                      <label class="selection-list__item">
                        <input type="checkbox" name="genre_ids[]" value="<%= child.id %>"
                               data-action="change->ui--popular-spots#updateParent"
                               data-ui--popular-spots-target="genreCheckbox">
                        <span><%= child.name %></span>
                      </label>
                    <% end %>
                  </div>
                </div>
              <% else %>
                <label class="selection-list__item">
                  <input type="checkbox" name="genre_ids[]" value="<%= genre.id %>"
                         data-ui--popular-spots-target="genreCheckbox">
                  <span><%= genre.name %></span>
                </label>
              <% end %>
            <% end %>
          </div>
        <% end %>
      </div>

      <button type="button"
              class="popular-spots-modal__submit-btn"
              data-action="click->ui--popular-spots#submit">
        <i class="bi bi-fire"></i>
        Ê±∫ÂÆö
      </button>
    </div>
  </div>
</div>
