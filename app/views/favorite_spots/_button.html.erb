<%# app/views/favorite_spots/_button.html.erb %>
<%# locals: spot:, favorite_spot: nil, animate: false %>
<%
  _animate = local_assigns.fetch(:animate, false)
  active_classes = "fav-button fav-button--heart fav-button--sm fav-button--active"
  active_classes += " fav-button--animate" if _animate
%>

<%= turbo_frame_tag dom_id(spot, :favorite_button) do %>
  <% if !current_user %>
    <button type="button"
            class="fav-button fav-button--heart fav-button--sm"
            aria-label="お気に入り登録（ログインが必要です）"
            disabled>
      <i class="bi bi-heart" aria-hidden="true"></i>
    </button>
  <% elsif favorite_spot.present? %>
    <%= button_to favorite_spot_path(favorite_spot),
                  method: :delete,
                  class: active_classes,
                  "aria-label": "お気に入り解除",
                  onanimationend: "this.classList.remove('fav-button--animate')",
                  data: { turbo_frame: dom_id(spot, :favorite_button) } do %>
      <i class="bi bi-heart-fill" aria-hidden="true"></i>
    <% end %>
  <% else %>
    <%= button_to favorite_spots_path(spot_id: spot.id),
                  method: :post,
                  class: "fav-button fav-button--heart fav-button--sm",
                  "aria-label": "お気に入り登録",
                  data: { turbo_frame: dom_id(spot, :favorite_button) } do %>
      <i class="bi bi-heart" aria-hidden="true"></i>
    <% end %>
  <% end %>
<% end %>
