<% content_for :body_class, "no-footer" %>

<script>
  window.spotData = {
    lat: <%= @spot.lat %>,
    lng: <%= @spot.lng %>,
    name: "<%= j @spot.name %>",
    address: "<%= j @spot.address.to_s %>",
    placeId: "<%= j @spot.place_id %>"
  };
</script>

<div class="main-content spot-detail"
     data-controller="navibar-resize"
     data-navibar-resize-min-value="300"
     data-navibar-resize-max-percent-value="80"
     data-navibar-resize-default-value="350"
     data-navibar-resize-storage-key-value="drive_peek:navibar_spot_width"
     data-navibar-resize-collapsed-key-value="drive_peek:navibar_spot_collapsed"
     data-navibar-resize-slide-key-value="drive_peek:navibar_spot_slide">
  <%# InfoWindowスケルトンテンプレート（JSから参照） %>
  <%= render "map/infowindow_skeleton" %>

  <!-- 地図 -->
  <div id="map" class="map" data-map-mode="spot_show" data-spot-id="<%= @spot.id %>" data-navibar-resize-target="map"></div>

  <!-- リサイズハンドル -->
  <div class="navibar-resize-handle"
       data-navibar-resize-target="handle"
       data-action="mousedown->navibar-resize#startResize touchstart->navibar-resize#startResize click->navibar-resize#handleClick">
    <div class="navibar-resize-handle__grip"></div>
  </div>

  <!-- ナビバー（スポット詳細用） -->
  <aside class="navibar navibar--show"
         data-controller="bottom-sheet"
         data-bottom-sheet-min-value="8"
         data-bottom-sheet-mid-value="45"
         data-bottom-sheet-max-value="85"
         data-bottom-sheet-state-value="mid">
    <%# モバイル用ドラッグハンドル %>
    <div class="navibar__handle" data-bottom-sheet-target="handle">
      <div class="navibar__handle-bar"></div>
    </div>

    <div class="navibar__content">
      <div class="navibar__content-scroll">
        <!-- ヘッダー -->
        <div class="navibar__header">
          <%= link_to :back, class: "spot-detail__back-link" do %>
            <i class="bi bi-chevron-left" aria-hidden="true"></i>
          <% end %>
          <h1 class="navibar__title"><%= @spot.name %></h1>
          <div class="spot-detail__header-like">
            <%= render "favorite_spots/button", spot: @spot, favorite_spot: @favorite_spot %>
          </div>
        </div>

        <!-- コンテンツ -->
        <div class="navibar__blocks">
          <div class="spot-detail__main">
            <% if @spot.address.present? %>
              <div class="spot-detail__address"><%= @spot.address %></div>
            <% end %>

            <% if @spot.genres.any? %>
              <div class="spot-detail__genres">
                <% @spot.genres.each do |genre| %>
                  <span class="spot-detail__genre"><%= genre.name %></span>
                <% end %>
              </div>
            <% end %>
          </div>

        </div>
      </div>
    </div>
  </aside>

  <%# モバイル用InfoWindowボトムシート %>
  <div id="mobile-infowindow"
       class="mobile-infowindow"
       data-controller="mobile-infowindow"
       hidden>
    <div class="mobile-infowindow__backdrop" data-action="click->mobile-infowindow#close"></div>
    <div class="mobile-infowindow__sheet" data-mobile-infowindow-target="sheet">
      <div class="mobile-infowindow__handle" data-mobile-infowindow-target="handle">
        <div class="mobile-infowindow__handle-bar"></div>
      </div>
      <button type="button"
              class="mobile-infowindow__close-btn"
              data-action="click->mobile-infowindow#close">
        <i class="bi bi-x-lg"></i>
      </button>
      <div class="mobile-infowindow__content" id="mobile-infowindow-content">
        <%# InfoWindow コンテンツがここに挿入される %>
      </div>
      <div class="mobile-infowindow__footer" id="mobile-infowindow-footer" hidden>
        <%# コメントフッターがJSで移動される %>
      </div>
    </div>
  </div>
</div>
