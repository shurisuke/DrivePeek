# DrivePeek

サービスURL：https://drivepeek.onrender.com/

<!-- TODO: Qiita記事等があれば追加 -->

<img width="1200" alt="DrivePeek サービス画面" src="https://github.com/user-attachments/assets/sample-hero-image" />

# ■ サービス概要
**3つの探し方で見つけて、計画、そのまま出発。**

DrivePeekは、地図検索・AI提案・みんなのプランの3つの方法でスポットを見つけ、滞在時間・移動時間・有料道路の有無を加味したドライブプランを作成できるアプリです。
完成したプランはそのままGoogle Mapsのナビに連携できます。


# ■ 機能紹介

## 🗺️ プラン作成
<table>
  <tr>
    <td width="50%" align="center"><strong>スポットを見つけてプランに追加</strong></td>
    <td width="50%" align="center"><strong>InfoWindow（スポット詳細）</strong></td>
  </tr>
  <tr>
    <td width="50%" align="center">
      <img src="https://github.com/user-attachments/assets/sample-plan-map" alt="スポットをプランに追加">
    </td>
    <td width="50%" align="center">
      <img src="https://github.com/user-attachments/assets/sample-plan-infowindow" alt="InfoWindow">
    </td>
  </tr>
  <tr>
    <td width="50%">地図検索・コミュニティ・AI提案、好きな方法でスポットを見つけてプランに追加。<br>並び替えも自由自在です。</td>
    <td width="50%">地図マーカーをクリックするとスポット情報をその場で表示。<br>写真・ジャンル・お気に入り・コメントをまとめて確認できます。</td>
  </tr>
</table>

## ⏱️ スケジュール自動計算
<table>
  <tr>
    <td width="50%" align="center"><strong>リアルなスケジューリング</strong></td>
    <td width="50%" align="center"><strong>ナビバーでドライブの流れをひと目で把握</strong></td>
  </tr>
  <tr>
    <td width="50%" align="center">
      <img src="https://github.com/user-attachments/assets/sample-scheduling" alt="リアルなスケジューリング">
    </td>
    <td width="50%" align="center">
      <img src="https://github.com/user-attachments/assets/sample-navibar" alt="ナビバーUI">
    </td>
  </tr>
  <tr>
    <td width="50%">滞在時間・移動時間・有料道路の有無まで加味した、実際の旅程に近いスケジュールを自動生成します。</td>
    <td width="50%">出発から帰宅までの時刻をナビバーに一覧表示。<br>スケジュール全体の流れをひと目で把握できます。</td>
  </tr>
</table>

## 🤖 AI スポット提案
<table>
  <tr>
    <td width="50%" align="center"><strong>エリア＆ジャンルを選ぶだけ</strong></td>
    <td width="50%" align="center"><strong>プラン・スポットをまるごと提案</strong></td>
  </tr>
  <tr>
    <td width="50%" align="center">
      <img src="https://github.com/user-attachments/assets/sample-ai-select" alt="エリア＆ジャンル選択">
    </td>
    <td width="50%" align="center">
      <img src="https://github.com/user-attachments/assets/sample-ai-proposal" alt="AI提案結果">
    </td>
  </tr>
  <tr>
    <td width="50%">地図上でエリアを囲んでジャンルを選択。<br>文字入力なしでAIに提案をおまかせできます。</td>
    <td width="50%">AIがスポットだけでなくプランも提案。<br>プランは気に入ったらまるごと一括採用できます。</td>
  </tr>
</table>

## 🌐 コミュニティ
<table>
  <tr>
    <td width="50%" align="center"><strong>スポット・プラン検索</strong></td>
    <td width="50%" align="center"><strong>気になるプランを地図で追体験</strong></td>
  </tr>
  <tr>
    <td width="50%" align="center">
      <img src="https://github.com/user-attachments/assets/sample-community-search" alt="コミュニティ検索">
    </td>
    <td width="50%" align="center">
      <img src="https://github.com/user-attachments/assets/sample-community-preview" alt="気になるプランを地図で追体験">
    </td>
  </tr>
  <tr>
    <td width="50%">位置・ジャンル・フリーワードで他ユーザーのスポットやプランを検索できます。</td>
    <td width="50%">スポットカード・プランカードから地図上にプレビュー表示。<br>今のルートと比べながら、寄り道先を手軽に検討できます。</td>
  </tr>
</table>

## 🚗 Google Mapsナビ連携
<table>
  <tr>
    <td width="50%" align="center"><strong>ワンタップでナビ起動</strong></td>
    <td width="50%" align="center"><strong>出発地・経由地を自動連携</strong></td>
  </tr>
  <tr>
    <td width="50%" align="center">
      <img src="https://github.com/user-attachments/assets/sample-nav-launch" alt="ナビ起動">
    </td>
    <td width="50%" align="center">
      <img src="https://github.com/user-attachments/assets/sample-nav-waypoints" alt="経由地連携">
    </td>
  </tr>
  <tr>
    <td width="50%">完成したプランからGoogle Mapsのナビをワンタップで起動できます。</td>
    <td width="50%">出発地・経由地・目的地がそのまま引き継がれ、すぐに出発できます。</td>
  </tr>
</table>

## 📱 モバイル対応
<table>
  <tr>
    <td width="50%" align="center"><strong>BottomSheet UI</strong></td>
    <td width="50%" align="center"><strong>モバイル最適化UI</strong></td>
  </tr>
  <tr>
    <td width="50%" align="center">
      <img src="https://github.com/user-attachments/assets/sample-mobile-bottomsheet" alt="モバイル BottomSheet">
    </td>
    <td width="50%" align="center">
      <img src="https://github.com/user-attachments/assets/sample-mobile-ui" alt="モバイルUI">
    </td>
  </tr>
  <tr>
    <td width="50%">モバイルではナビバーやInfoWindowをBottomSheet形式で表示。<br>スワイプで自由に開閉できます。</td>
    <td width="50%">プラン編集・AI提案・コミュニティすべてモバイル最適化。<br>スポットの並び替えは上下ボタンで直感的に操作できます。</td>
  </tr>
</table>

## その他の機能

| 機能 | 説明 |
|------|------|
| お気に入り | スポット・プランをワンタップで保存、一覧管理 |
| メモ | スポットごとに注意点・買いたいものなどを記録 |
| SNS ログイン | LINE / X (Twitter) でワンクリック認証 |
| SNS シェア | プランを LINE / X / URL コピーで共有 |


# ■ 技術構成について

## 使用技術
| カテゴリ | 技術・ツール |
|---------|-------------|
| **バックエンド** | Ruby 3.2.2 / Ruby on Rails 8.1 |
| **フロントエンド** | Hotwire (Turbo + Stimulus) / Importmap / JavaScript |
| **UI/CSS** | Bootstrap 5 / SCSS (cssbundling-rails) |
| **データベース** | PostgreSQL |
| **認証** | Devise / OmniAuth (LINE / X) |
| **AI** | OpenAI API (ruby-openai) |
| **地図** | Google Maps JavaScript API / Places API / Directions API |
| **インフラ・デプロイ** | Render |
| **CI/CD** | GitHub Actions (RSpec / RuboCop / Brakeman) |
| **テスト** | RSpec / Factory Bot / Capybara / SimpleCov |
| **その他** | Kaminari (ページネーション) / Rack::Attack (レート制限) / Resend (メール) / Kramdown (Markdown) / Flatpickr (日時入力) / Solid Queue (ジョブ) / Solid Cache (キャッシュ) |

## 技術選定の理由
- **Ruby on Rails**: スポットやプランの管理等、サーバー側の処理はCRUDが中心のため、規約に沿うだけで素早く実装できるRailsを選択
- **Hotwire (Turbo + Stimulus)**: Rails標準搭載のフロントエンド技術として採用。サーバー側でUI状態を管理でき、別途フレームワークなしでリアルタイムなUI更新を実現できた
- **Google Maps API**: Mapbox等と比較し、日本のスポットデータの充実度からGoogle Mapsを選択。Places APIで写真・営業時間等を取得でき、スポットDBを自前で持たずに済んだ
- **OpenAI API**: 構造化出力（JSON Schema）により、AIの応答からスポット情報を安定して抽出。Turbo Streamと組み合わせ、応答をストリーミング表示している


## Stimulus コントローラ構成

機能ドメインごとにディレクトリを分割し、責務を明確化しています（全38コントローラ）。

```
app/javascript/controllers/
├── plan_tab/          # プランタブ（スポット操作・時間管理）
├── community_tab/     # コミュニティタブ（検索・プレビュー）
├── suggestion_tab/    # AI提案タブ（エリア指定・プラン採用）
├── infowindow/        # InfoWindow（スポット詳細・コメント・写真）
└── ui/                # 汎用 UI（BottomSheet・ナビバー・モーダル等）
```

**設計方針**: サーバーがUI状態を決定し、Stimulusは表示制御・API通信に徹する。機能ドメインごとにディレクトリを分け、横断UIは `ui/` に集約。


## ER図

<img alt="ER図" src="https://i.gyazo.com/301ff37253a0d2e6e3dcaa906b9c8971.png" />


## テスト

| テスト種別 | 内容 |
|-----------|------|
| Model spec | バリデーション・アソシエーション・ビジネスロジック |
| Request spec | APIエンドポイント・認証・CRUD |
| System spec | E2E（Capybara + Selenium） |
| Service spec | AI提案サービス |
| Mailer spec | メール送信 |
| **合計** | **372 examples, 0 failures** |

静的解析: RuboCop + Brakeman（セキュリティスキャン）

CI: GitHub ActionsでPRごとにRSpec・RuboCop・Brakemanを自動実行


## 画面遷移図
Figma：https://www.figma.com/design/k9Qhg0des02wxAjroLW3MA/DrivePeek-%E7%94%BB%E9%9D%A2%E9%81%B7%E7%A7%BB%E5%9B%B3-?node-id=0-1&p=f&t=Y0GH5C5Pvvhz2Ot9-0


# ■ サービス開発の背景
私自身、休日のドライブが大好きで日々のリフレッシュになっています。
しかし計画段階で、いつも同じ悩みにぶつかっていました。

「途中でどこか寄りたいけど、どこかいい所ないかな...」
「滞在時間を考えると、帰りは何時になるんだろう...」
「行き先で何を食べようか、毎回決まらない...」

こうした **行き先探し・時間計算・食事選び** の3つの課題を、**地図 + AI + コミュニティ** で一気に解決したいという思いから開発しました。
他のユーザーのリアルなプランを参考にしたり、AIに提案してもらうことで、「思い立ったらすぐ出発できる」体験を目指しています。
